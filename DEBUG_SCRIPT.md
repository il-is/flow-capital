# Отладка Google Apps Script для дашборда

## Проблема: "Произошла ошибка" или HTML вместо JSON

Если вы видите ошибку Google Drive или HTML страницу вместо JSON, следуйте этим шагам:

## Шаг 1: Проверьте URL скрипта в .env.local

Убедитесь, что в `.env.local` указан **реальный URL**, а не плейсхолдер:

```env
# ❌ НЕПРАВИЛЬНО:
GOOGLE_SCRIPT_DASHBOARD_URL=https://script.google.com/macros/s/ВАШ_URL/exec

# ✅ ПРАВИЛЬНО (пример):
GOOGLE_SCRIPT_DASHBOARD_URL=https://script.google.com/macros/s/AKfycbz1234567890abcdef/exec
```

**Как получить правильный URL:**
1. Откройте [Google Apps Script](https://script.google.com/)
2. Найдите ваш проект "Flow Capital Dashboard Reader"
3. Нажмите "Развернуть" → "Управление развертываниями"
4. Скопируйте URL из колонки "URL веб-приложения"
5. URL должен начинаться с `https://script.google.com/macros/s/` и заканчиваться на `/exec`

## Шаг 2: Проверьте развертывание скрипта

1. Откройте проект скрипта в Google Apps Script
2. Нажмите "Развернуть" → "Управление развертываниями"
3. Если развертывания нет:
   - Нажмите "Развернуть" → "Новое развертывание"
   - Выберите тип: **"Веб-приложение"**
   - Описание: "Flow Capital Dashboard API"
   - Выполнять от имени: **"Я"** (ваш email)
   - У кого есть доступ: **"Все"** (важно!)
   - Нажмите "Развернуть"
   - Скопируйте URL

4. Если развертывание есть, но не работает:
   - Нажмите на значок редактирования (карандаш)
   - Убедитесь, что:
     - Тип: "Веб-приложение"
     - Выполнять от имени: "Я"
     - У кого есть доступ: **"Все"**
   - Нажмите "Обновить"
   - Скопируйте новый URL (может измениться)

## Шаг 3: Проверьте доступ к таблицам

Скрипт должен иметь доступ к обеим таблицам:

### Таблица с заявками (ID: `1w_cGblOqZ1swSI9XZsoo5BNjA_8lJ3v_5_Fl-LFfCfk`)
1. Откройте таблицу
2. Нажмите "Поделиться"
3. Добавьте email аккаунта, от имени которого выполняется скрипт
4. Дайте права "Читатель" или "Редактор"

### Таблица со скорингом (ID: `1Q2DMl-r7MZmpNNdYlj1y6jvGJcjgnVrUmHtbNm-r-O0`)
1. Откройте таблицу
2. Нажмите "Поделиться"
3. Добавьте тот же email
4. Дайте права "Читатель" или "Редактор"

## Шаг 4: Проверьте код скрипта

Убедитесь, что в скрипте правильно указаны ID таблиц:

```javascript
const STARTUP_SPREADSHEET_ID = '1w_cGblOqZ1swSI9XZsoo5BNjA_8lJ3v_5_Fl-LFfCfk';
const SCORING_SPREADSHEET_ID = '1Q2DMl-r7MZmpNNdYlj1y6jvGJcjgnVrUmHtbNm-r-O0';
```

## Шаг 5: Тестирование скрипта напрямую

Откройте в браузере URL скрипта с параметрами:

```
https://script.google.com/macros/s/ВАШ_РЕАЛЬНЫЙ_URL/exec?action=getStartupsWithScoring
```

**Ожидаемый результат:**
Должен вернуться JSON:
```json
{"success":true,"startups":[...]}
```

**Если видите:**
- HTML страницу ошибки → скрипт не развернут или неправильно настроен
- Страницу авторизации → скрипт требует авторизации (измените "У кого есть доступ" на "Все")
- Пустой ответ → проверьте доступ к таблицам

## Шаг 6: Проверьте логи скрипта

1. В Google Apps Script откройте "Выполнения" (справа)
2. Посмотрите последние выполнения
3. Если есть ошибки, они будут показаны там

## Шаг 7: Перезапустите dev-сервер

После изменения `.env.local`:
1. Остановите dev-сервер (Ctrl+C)
2. Запустите снова: `npm run dev`
3. Обновите страницу дашборда

## Частые проблемы

### Проблема: "Script function not found"
**Решение:** Убедитесь, что функция `doGet` существует в скрипте

### Проблема: "Access denied"
**Решение:** Измените "У кого есть доступ" на "Все" в настройках развертывания

### Проблема: "Sheet not found"
**Решение:** Проверьте, что листы называются точно:
- "Заявки стартапов" (для основной таблицы)
- "Скоринг" (для таблицы скоринга)

### Проблема: URL содержит "ВАШ_URL"
**Решение:** Замените плейсхолдер на реальный URL из развертывания

